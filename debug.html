<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„¿ç«¥è¯†å­—å°æŠ¥ç”Ÿæˆå™¨ - è°ƒè¯•ç‰ˆ</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        .debug-panel {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .debug-log {
            max-height: 200px;
            overflow-y: auto;
            background: white;
            padding: 10px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- è°ƒè¯•é¢æ¿ -->
        <div class="debug-panel">
            <h3>è°ƒè¯•ä¿¡æ¯</h3>
            <div id="debugInfo"></div>
            <div class="debug-log" id="debugLog"></div>
            <button onclick="clearDebugLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>

        <!-- é¡µé¢æ ‡é¢˜ -->
        <header class="header">
            <h1 class="title">
                <span class="emoji">ğŸ“š</span>
                å„¿ç«¥è¯†å­—å°æŠ¥ç”Ÿæˆå™¨ï¼ˆè°ƒè¯•ç‰ˆï¼‰
            </h1>
            <p class="subtitle">ä¸º5-9å²å„¿ç«¥åˆ›å»ºæœ‰è¶£çš„è¯†å­—å­¦ä¹ å°æŠ¥</p>
        </header>

        <!-- APIå¯†é’¥è®¾ç½®åŒºåŸŸ -->
        <section class="api-key-section">
            <div class="input-group">
                <label for="apiKey">APIå¯†é’¥ï¼š</label>
                <input type="text" id="apiKey" placeholder="è¯·è¾“å…¥æ‚¨çš„Nano Banana Pro APIå¯†é’¥">
                <button id="saveApiKey" class="btn btn-secondary">ä¿å­˜</button>
            </div>
        </section>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <section class="input-section" id="inputSection">
            <h2 class="section-title">åˆ›å»ºè¯†å­—å°æŠ¥</h2>

            <div class="input-group">
                <label for="theme">ä¸»é¢˜/åœºæ™¯ï¼š</label>
                <select id="theme" class="theme-select">
                    <option value="">è¯·é€‰æ‹©ä¸»é¢˜</option>
                    <option value="è¶…å¸‚">è¶…å¸‚</option>
                    <option value="åŒ»é™¢">åŒ»é™¢</option>
                    <option value="å…¬å›­">å…¬å›­</option>
                    <option value="å­¦æ ¡">å­¦æ ¡</option>
                    <option value="åŠ¨ç‰©å›­">åŠ¨ç‰©å›­</option>
                    <option value="å®¶åº­">å®¶åº­</option>
                    <option value="é¤å…">é¤å…</option>
                    <option value="å›¾ä¹¦é¦†">å›¾ä¹¦é¦†</option>
                </select>
                <input type="text" id="customTheme" placeholder="æˆ–è¾“å…¥è‡ªå®šä¹‰ä¸»é¢˜">
            </div>

            <div class="input-group">
                <label for="newspaperTitle">å°æŠ¥æ ‡é¢˜ï¼š</label>
                <input type="text" id="newspaperTitle" placeholder="ä¾‹å¦‚ï¼šã€Šèµ°è¿›è¶…å¸‚ã€‹ã€Šå¿«ä¹åŒ»é™¢ã€‹">
            </div>

            <button id="generateBtn" class="btn btn-primary" disabled>
                <span class="emoji">âœ¨</span>
                ç”Ÿæˆå°æŠ¥
            </button>
        </section>

        <!-- è¿›åº¦æ˜¾ç¤ºåŒºåŸŸ -->
        <section class="progress-section" id="progressSection" style="display: none;">
            <h3 class="section-title">ç”Ÿæˆè¿›åº¦</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="progress-text" id="progressText">æ­£åœ¨åˆ›å»ºä»»åŠ¡...</p>
        </section>

        <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
        <section class="result-section" id="resultSection" style="display: none;">
            <h3 class="section-title">ç”Ÿæˆç»“æœ</h3>
            <div class="result-container">
                <div class="image-container">
                    <img id="generatedImage" src="" alt="ç”Ÿæˆçš„è¯†å­—å°æŠ¥">
                    <div class="image-overlay" id="imageOverlay">
                        <span class="loading-text">å›¾ç‰‡åŠ è½½ä¸­...</span>
                    </div>
                </div>
                <div class="result-actions">
                    <button id="downloadBtn" class="btn btn-success">
                        <span class="emoji">ğŸ’¾</span>
                        ä¸‹è½½å›¾ç‰‡
                    </button>
                    <button id="regenerateBtn" class="btn btn-secondary">
                        <span class="emoji">ğŸ”„</span>
                        é‡æ–°ç”Ÿæˆ
                    </button>
                    <button id="newspaperBtn" class="btn btn-info">
                        <span class="emoji">ğŸ“°</span>
                        ç”Ÿæˆæ–°çš„å°æŠ¥
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- é”™è¯¯æç¤º -->
    <div class="error-toast" id="errorToast" style="display: none;">
        <span class="error-icon">âš ï¸</span>
        <span class="error-message" id="errorMessage"></span>
        <button class="error-close" onclick="hideError()">&times;</button>
    </div>

    <!-- æˆåŠŸæç¤º -->
    <div class="success-toast" id="successToast" style="display: none;">
        <span class="success-icon">âœ…</span>
        <span class="success-message" id="successMessage"></span>
    </div>

    <!-- å¼•å…¥JavaScriptæ–‡ä»¶ -->
    <script src="js/utils.js"></script>
    <script src="js/prompt-generator.js"></script>
    <script src="js/api.js"></script>
    <script>
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(message) {
            const log = document.getElementById('debugLog');
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `[${time}] ${message}<br>`;
            log.scrollTop = log.scrollHeight;
            console.log(message);
        }

        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            const apiKey = document.getElementById('apiKey').value;
            const theme = document.getElementById('theme').value;
            const customTheme = document.getElementById('customTheme').value;
            const title = document.getElementById('newspaperTitle').value;
            const generateBtn = document.getElementById('generateBtn');

            debugInfo.innerHTML = `
                APIå¯†é’¥: ${apiKey ? 'å·²è¾“å…¥(' + apiKey.length + 'å­—ç¬¦)' : 'æœªè¾“å…¥'}<br>
                ä¸»é¢˜: ${theme || 'æœªé€‰æ‹©'}<br>
                è‡ªå®šä¹‰ä¸»é¢˜: ${customTheme || 'æœªè¾“å…¥'}<br>
                æ ‡é¢˜: ${title || 'æœªè¾“å…¥'}<br>
                ç”ŸæˆæŒ‰é’®çŠ¶æ€: ${generateBtn.disabled ? 'ç¦ç”¨' : 'å¯ç”¨'}<br>
                localStorageå¯ç”¨: ${typeof(Storage) !== "undefined" ? 'æ˜¯' : 'å¦'}
            `;
        }

        // æ¸…é™¤è°ƒè¯•æ—¥å¿—
        function clearDebugLog() {
            document.getElementById('debugLog').innerHTML = '';
        }

        // é‡å†™showErrorå‡½æ•°ä»¥æ·»åŠ è°ƒè¯•æ—¥å¿—
        const originalShowError = showError;
        window.showError = function(message) {
            debugLog('é”™è¯¯: ' + message);
            originalShowError(message);
        };

        // é‡å†™showSuccesså‡½æ•°ä»¥æ·»åŠ è°ƒè¯•æ—¥å¿—
        const originalShowSuccess = showSuccess;
        window.showSuccess = function(message) {
            debugLog('æˆåŠŸ: ' + message);
            originalShowSuccess(message);
        };

        // ç›‘å¬æ‰€æœ‰è¾“å…¥å˜åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            debugLog('é¡µé¢åŠ è½½å®Œæˆ');

            // ç›‘å¬æ‰€æœ‰è¾“å…¥
            document.getElementById('apiKey').addEventListener('input', () => {
                updateDebugInfo();
            });

            document.getElementById('theme').addEventListener('change', () => {
                debugLog('ä¸»é¢˜é€‰æ‹©: ' + document.getElementById('theme').value);
                updateDebugInfo();
            });

            document.getElementById('customTheme').addEventListener('input', () => {
                updateDebugInfo();
            });

            document.getElementById('newspaperTitle').addEventListener('input', () => {
                updateDebugInfo();
            });

            // ç›‘å¬ç”ŸæˆæŒ‰é’®ç‚¹å‡»
            document.getElementById('generateBtn').addEventListener('click', () => {
                debugLog('ç”ŸæˆæŒ‰é’®è¢«ç‚¹å‡»');
            });

            // å®šæœŸæ›´æ–°è°ƒè¯•ä¿¡æ¯
            setInterval(updateDebugInfo, 1000);

            // åˆå§‹åŒ–è°ƒè¯•ä¿¡æ¯
            updateDebugInfo();

            // åˆå§‹åŒ–app.js
            const script = document.createElement('script');
            script.src = 'js/app.js';
            script.onload = () => {
                debugLog('app.js åŠ è½½æˆåŠŸ');
            };
            script.onerror = () => {
                debugLog('app.js åŠ è½½å¤±è´¥');
            };
            document.head.appendChild(script);
        });
    </script>
</body>
</html>