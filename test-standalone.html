<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„¿ç«¥è¯†å­—å°æŠ¥ç”Ÿæˆå™¨ - ç‹¬ç«‹æµ‹è¯•ç‰ˆ</title>
    <style>
        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
            font-size: 1.1em;
        }
        input, select {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1em;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            color: white;
            margin-right: 10px;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #718096 0%, #4a5568 100%);
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 30px 0;
        }
        .title {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .error-toast, .success-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        .error-toast {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        .success-toast {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
        }
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        .debug-info {
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡µé¢æ ‡é¢˜ -->
        <header class="header">
            <h1 class="title">ğŸ“š å„¿ç«¥è¯†å­—å°æŠ¥ç”Ÿæˆå™¨</h1>
            <p class="subtitle">ä¸º5-9å²å„¿ç«¥åˆ›å»ºæœ‰è¶£çš„è¯†å­—å­¦ä¹ å°æŠ¥</p>
        </header>

        <!-- APIå¯†é’¥è®¾ç½®åŒºåŸŸ -->
        <section class="api-key-section" id="api-key-section">
            <div class="input-group">
                <label for="apiKey">APIå¯†é’¥ï¼š</label>
                <input type="password" id="apiKey" placeholder="è¯·è¾“å…¥æ‚¨çš„Nano Banana Pro APIå¯†é’¥">
                <button class="btn btn-secondary" onclick="saveApiKey()">ä¿å­˜å¯†é’¥</button>
            </div>
        </section>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <section class="input-section" id="inputSection" style="display: none;">
            <h2>åˆ›å»ºè¯†å­—å°æŠ¥</h2>

            <div class="input-group">
                <label for="theme">ä¸»é¢˜/åœºæ™¯ï¼š</label>
                <select id="theme">
                    <option value="">è¯·é€‰æ‹©ä¸»é¢˜</option>
                    <option value="è¶…å¸‚">è¶…å¸‚</option>
                    <option value="åŒ»é™¢">åŒ»é™¢</option>
                    <option value="å…¬å›­">å…¬å›­</option>
                    <option value="å­¦æ ¡">å­¦æ ¡</option>
                    <option value="åŠ¨ç‰©å›­">åŠ¨ç‰©å›­</option>
                </select>
                <input type="text" id="customTheme" placeholder="æˆ–è¾“å…¥è‡ªå®šä¹‰ä¸»é¢˜">
            </div>

            <div class="input-group">
                <label for="newspaperTitle">å°æŠ¥æ ‡é¢˜ï¼š</label>
                <input type="text" id="newspaperTitle" placeholder="ä¾‹å¦‚ï¼šã€Šèµ°è¿›è¶…å¸‚ã€‹ã€Šå¿«ä¹åŒ»é™¢ã€‹">
            </div>

            <button class="btn-primary" id="generateBtn" disabled onclick="generateNewspaper()">
                <span>âœ¨</span> ç”Ÿæˆå°æŠ¥
            </button>

            <!-- è°ƒè¯•ä¿¡æ¯ -->
            <div class="debug-info" id="debugInfo">
                è°ƒè¯•ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º...
            </div>
        </section>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="error-toast" id="errorToast" style="display: none;">
        <span id="errorMessage"></span>
    </div>
    <div class="success-toast" id="successToast" style="display: none;">
        <span id="successMessage"></span>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let hasApiKey = false;

        // æ›´æ–°è°ƒè¯•ä¿¡æ¯
        function updateDebugInfo() {
            const debugInfo = document.getElementById('debugInfo');
            const themeSelect = document.getElementById('theme');
            const customThemeInput = document.getElementById('customTheme');
            const titleInput = document.getElementById('newspaperTitle');
            const generateBtn = document.getElementById('generateBtn');

            if (!debugInfo || !themeSelect || !customThemeInput || !titleInput || !generateBtn) {
                console.log('ç¼ºå°‘å¿…è¦çš„DOMå…ƒç´ ');
                return;
            }

            const hasTheme = themeSelect.value || customThemeInput.value.trim();
            const hasTitle = titleInput.value.trim();

            generateBtn.disabled = !(hasTheme && hasTitle && hasApiKey);

            debugInfo.innerHTML = `
                <strong>è°ƒè¯•ä¿¡æ¯ï¼š</strong><br>
                APIå¯†é’¥: ${hasApiKey ? 'å·²ä¿å­˜' : 'æœªä¿å­˜'}<br>
                ä¸»é¢˜é€‰æ‹©: "${themeSelect.value}"<br>
                è‡ªå®šä¹‰ä¸»é¢˜: "${customThemeInput.value}"<br>
                æ ‡é¢˜: "${titleInput.value}"<br>
                æœ‰ä¸»é¢˜: ${hasTheme}<br>
                æœ‰æ ‡é¢˜: ${hasTitle}<br>
                æŒ‰é’®çŠ¶æ€: ${generateBtn.disabled ? 'ç¦ç”¨' : 'å¯ç”¨'}
            `;

            // æ§åˆ¶å°æ—¥å¿—
            console.log('æŒ‰é’®çŠ¶æ€æ›´æ–°:', {
                hasApiKey: hasApiKey,
                theme: themeSelect.value,
                customTheme: customThemeInput.value,
                title: titleInput.value,
                hasTheme: hasTheme,
                hasTitle: hasTitle,
                disabled: generateBtn.disabled
            });
        }

        // ä¿å­˜APIå¯†é’¥
        function saveApiKey() {
            const apiKeyInput = document.getElementById('apiKey');
            if (!apiKeyInput) return;

            const apiKey = apiKeyInput.value.trim();
            if (apiKey.length < 10) {
                showError('è¯·è¾“å…¥æœ‰æ•ˆçš„APIå¯†é’¥ï¼ˆè‡³å°‘10ä¸ªå­—ç¬¦ï¼‰');
                return;
            }

            hasApiKey = true;
            localStorage.setItem('apiKey', apiKey);

            // åˆ‡æ¢æ˜¾ç¤º
            document.getElementById('api-key-section').style.display = 'none';
            document.getElementById('inputSection').style.display = 'block';

            showSuccess('APIå¯†é’¥å·²ä¿å­˜');
            updateDebugInfo();
        }

        // ä¸»é¢˜é€‰æ‹©å¤„ç†
        document.getElementById('theme').addEventListener('change', function(e) {
            const customThemeInput = document.getElementById('customTheme');
            if (e.target.value) {
                customThemeInput.value = '';
                customThemeInput.disabled = true;
            } else {
                customThemeInput.disabled = false;
                customThemeInput.focus();
            }
            updateDebugInfo();
        });

        // ç›‘å¬æ‰€æœ‰è¾“å…¥
        document.getElementById('customTheme').addEventListener('input', updateDebugInfo);
        document.getElementById('newspaperTitle').addEventListener('input', updateDebugInfo);

        // ç”Ÿæˆå°æŠ¥
        function generateNewspaper() {
            const themeSelect = document.getElementById('theme');
            const customThemeInput = document.getElementById('customTheme');
            const titleInput = document.getElementById('newspaperTitle');

            const theme = themeSelect.value || customThemeInput.value.trim();
            const title = titleInput.value.trim();

            if (!theme || !title) {
                showError('è¯·å¡«å†™ä¸»é¢˜å’Œæ ‡é¢˜');
                return;
            }

            if (!hasApiKey) {
                showError('è¯·å…ˆè®¾ç½®APIå¯†é’¥');
                return;
            }

            // æ¨¡æ‹Ÿç”Ÿæˆè¿‡ç¨‹
            const generateBtn = document.getElementById('generateBtn');
            const originalText = generateBtn.innerHTML;
            generateBtn.disabled = true;
            generateBtn.innerHTML = 'âš™ï¸ ç”Ÿæˆä¸­...';

            setTimeout(() => {
                generateBtn.disabled = false;
                generateBtn.innerHTML = originalText;
                showSuccess('æµ‹è¯•æˆåŠŸï¼ä¸»é¢˜ï¼š' + theme + 'ï¼Œæ ‡é¢˜ï¼š' + title);
            }, 2000);
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showError(message) {
            const errorToast = document.getElementById('errorToast');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorToast.style.display = 'block';
            setTimeout(() => {
                errorToast.style.display = 'none';
            }, 3000);
        }

        function showSuccess(message) {
            const successToast = document.getElementById('successToast');
            const successMessage = document.getElementById('successMessage');
            successMessage.textContent = message;
            successToast.style.display = 'block';
            setTimeout(() => {
                successToast.style.display = 'none';
            }, 3000);
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥APIå¯†é’¥
        window.addEventListener('load', () => {
            const savedApiKey = localStorage.getItem('apiKey');
            if (savedApiKey) {
                hasApiKey = true;
                document.getElementById('apiKey').value = savedApiKey;
                document.getElementById('api-key-section').style.display = 'none';
                document.getElementById('inputSection').style.display = 'block';
                showSuccess('å·²åŠ è½½ä¿å­˜çš„APIå¯†é’¥');
            }
            updateDebugInfo();
        });

        // å®šæœŸæ›´æ–°è°ƒè¯•ä¿¡æ¯
        setInterval(updateDebugInfo, 1000);
    </script>
</body>
</html>